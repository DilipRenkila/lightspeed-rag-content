Backing up and restoring etcd on AWS

You can back up and restore etcd on a hosted cluster on Amazon Web Services (AWS) to fix failures.

Hosted control planes on the AWS platform is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.

For more information about the support scope of Red Hat Technology Preview features, see Technology Preview Features Support Scope.
Taking a snapshot of etcd for a hosted cluster
To back up etcd for a hosted cluster, you must take a snapshot of etcd. Later, you can restore etcd by using the snapshot.

This procedure requires API downtime.
Pause reconciliation of the hosted cluster by entering the following command:

Stop all etcd-writer deployments by entering the following command:

To take an etcd snapshot, use the exec command in each etcd container by entering the following command:

To check the snapshot status, use the exec command in each etcd container by running the following command:

Copy the snapshot data to a location where you can retrieve it later, such as an S3 bucket. See the following example.

To restore the snapshot on a new cluster later, save the encryption secret that the hosted cluster references.


Restore the etcd snapshot.
Restoring an etcd snapshot on a hosted cluster
If you have a snapshot of etcd from your hosted cluster, you can restore it. Currently, you can restore an etcd snapshot only during cluster creation.

To restore an etcd snapshot, you modify the output from the create cluster --render command and define a restoreSnapshotURL value in the etcd section of the HostedCluster specification.

You took an etcd snapshot on a hosted cluster.

On the aws command-line interface (CLI), create a pre-signed URL so that you can download your etcd snapshot from S3 without passing credentials to the etcd deployment:

Modify the HostedCluster specification to refer to the URL:

Ensure that the secret that you referenced from the spec.secretEncryption.aescbc value contains the same AES key that you saved in the previous steps.
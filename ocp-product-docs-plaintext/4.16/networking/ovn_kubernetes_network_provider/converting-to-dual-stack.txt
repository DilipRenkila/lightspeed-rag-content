Converting to IPv4/IPv6 dual-stack networking

As a cluster administrator, you can convert your IPv4 single-stack cluster to a dual-network cluster network that supports IPv4 and IPv6 address families. After converting to dual-stack networking, new and existing pods have dual-stack networking enabled.

Clusters provisioned on bare metal, IBM Power(R), IBM Z(R) infrastructure, single-node OpenShift, and VMware vSphere support dual-stack networking.

When using dual-stack networking where IPv6 is required, you cannot use IPv4-mapped IPv6 addresses, such as ::FFFF:198.51.100.1.
Converting to a dual-stack cluster network
As a cluster administrator, you can convert your single-stack cluster network to a dual-stack cluster network. After converting to a dual-stack network, new and existing pods have dual-stack networking enabled.

Converting a single-stack cluster network to a dual-stack cluster network consists of creating patches and applying them to the cluster's network and infrastructure.

If you need to add IPv6 Virtual IPs (VIPs) for API and Ingress services to an existing dual-stack-configured cluster, you need to patch only the cluster's infrastructure and not the cluster's network.

Each patch operation that changes clusterNetwork, serviceNetwork, apiServerInternalIPs, and ingressIP objects triggers a restart of the cluster. Changing the MachineNetworks object does not cause a reboot of the cluster.
You installed the OpenShift CLI (oc).

You are logged in to the cluster with a user with cluster-admin privileges.

Your cluster uses the OVN-Kubernetes network plugin.

The cluster nodes have IPv6 addresses.

You have configured an IPv6-enabled router based on your infrastructure.


To specify IPv6 address blocks for the cluster and service networks, create a YAML configuration patch file that has a similar configuration to the following example:

Patch the cluster network configuration by entering the following command in your CLI:

To specify IPv6 VIPs for API and Ingress services for your cluster, create a YAML configuration patch file that has a similar configuration to the following example:

Patch the cluster's infrastructure by entering the following command in your CLI:


Show the cluster network configuration by entering the following command in your CLI:

Verify the successful installation of the patch on the network configuration by checking that the cluster network configuration recognizes the IPv6 address blocks that you specified in the YAML file.

Show the cluster infrastructure configuration by entering the following command in your CLI:

Verify the successful installation of the patch on the cluster infrastructure by checking that the infrastructure recognizes the IPv6 address blocks that you specified in the YAML file.
Converting to a single-stack cluster network
As a cluster administrator, you can convert your dual-stack cluster network to a single-stack cluster network.

You installed the OpenShift CLI (oc).

You are logged in to the cluster with a user with cluster-admin privileges.

Your cluster uses the OVN-Kubernetes network plugin.

The cluster nodes have IPv6 addresses.

You have enabled dual-stack networking.


Edit the networks.config.openshift.io custom resource (CR) by running the
following command:

Remove the IPv6 specific configuration that you have added to the cidr and hostPrefix fields in the previous procedure.